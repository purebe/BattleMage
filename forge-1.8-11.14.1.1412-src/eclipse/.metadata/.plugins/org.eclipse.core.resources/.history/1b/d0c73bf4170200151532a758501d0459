package purebe.battlemage.eventhandlers;

import net.minecraft.client.Minecraft;
import net.minecraft.client.renderer.GlStateManager;
import net.minecraft.client.renderer.Tessellator;
import net.minecraft.client.renderer.WorldRenderer;
import net.minecraft.util.ResourceLocation;
import net.minecraftforge.client.event.RenderGameOverlayEvent;
import net.minecraftforge.client.event.RenderGameOverlayEvent.ElementType;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

import org.lwjgl.opengl.GL11;

import purebe.battlemage.magic.SpellCaster.SpellSymbol;
import purebe.battlemage.main.ClientProxy;
import purebe.battlemage.main.Main;

public class GuiEvents {
	@SubscribeEvent
	public void RenderGameOverlayEvent(RenderGameOverlayEvent event) {
		if(event.isCancelable() || event.type != ElementType.EXPERIENCE)
	    {      
	      return;
	    }
		
		Tessellator tessellator = Tessellator.getInstance();
		WorldRenderer worldrenderer = Tessellator.getInstance().getWorldRenderer();
		
		GlStateManager.enableBlend();
		GlStateManager.blendFunc(GL11.GL_SRC_ALPHA, GL11.GL_ONE_MINUS_SRC_ALPHA);
		GlStateManager.color(1f, 1f, 1f, 1f);
		
		for (int i = 0; i < ((ClientProxy)Main.proxy).spellCaster.currentIncantation.size(); ++i) {
			SpellSymbol symbol = ((ClientProxy)Main.proxy).spellCaster.currentIncantation.get(i);
			
			double widthPadding = 40 / event.resolution.getScaleFactor();
			double heightPadding = 80 / event.resolution.getScaleFactor();
			double posX = (event.resolution.getScaledWidth() + widthPadding) / 2;
			double posY = (event.resolution.getScaledHeight() / 2) + heightPadding;
			double height = 32 / event.resolution.getScaleFactor();
			double width = 32 / event.resolution.getScaleFactor();
			
			DrawSymbol(SpellSymbol.White, posX, posY, width, height, tessellator, worldrenderer);
		}
		
		GlStateManager.disableBlend();
	}
	
	private void DrawSymbol(SpellSymbol symbol, double posX, double posY, double width, double height,
	                        Tessellator tessellator, WorldRenderer worldRenderer) {
		switch (symbol) {
		case White:
			Minecraft.getMinecraft().renderEngine.bindTexture(new ResourceLocation("battlemage:textures/gui/white_symbol.png"));
			break;
		case Black:
			Minecraft.getMinecraft().renderEngine.bindTexture(new ResourceLocation("battlemage:textures/gui/black_symbol.png"));
			break;
		case Chaos:
			Minecraft.getMinecraft().renderEngine.bindTexture(new ResourceLocation("battlemage:textures/gui/chaos_symbol.png"));
			break;
		case Nature:
			Minecraft.getMinecraft().renderEngine.bindTexture(new ResourceLocation("battlemage:textures/gui/nature_symbol.png"));
			break;
		case Power:
			Minecraft.getMinecraft().renderEngine.bindTexture(new ResourceLocation("battlemage:textures/gui/power_symbol.png"));
			break;
		}
		
		worldRenderer.startDrawingQuads();
		worldRenderer.addVertexWithUV(posX, posY + height, 0, 0, 1);
		worldRenderer.addVertexWithUV(posX + width, posY + height, 0, 1, 1);
		worldRenderer.addVertexWithUV(posX + width, posY, 0, 1, 0);
		worldRenderer.addVertexWithUV(posX, posY, 0, 0, 0);
		tessellator.draw();
	}
}
